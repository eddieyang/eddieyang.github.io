<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>你好，GitHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.9.3/qs.min.js"></script>-->
    <!--    <link href="./stylesheets/jp-font.css" rel="stylesheet" media="print" onload="this.media='all'">-->
    <!-- Fallback that only gets inserted when JavaScript is disabled, in which case we can't load CSS asynchronously. -->
    <noscript>
        <link rel="stylesheet" href="./stylesheets/jp-font.css">
    </noscript>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@3.5.0/dist/fetch.umd.min.js"></script>
    <style>
      /*@font-face {*/
      /*  font-family: "Noto Sans JP";*/
      /*  src: url("./stylesheets/fonts/NotoSansJP-Regular.otf");*/
      /*  font-display: swap;*/
      /*}*/
      /*@font-face {*/
      /*  font-family: "Noto Sans JP";*/
      /*  src: url("./stylesheets/fonts/NotoSansJP-Bold.otf");*/
      /*  font-weight: bold;*/
      /*  font-display: swap;*/
      /*}*/

      h2 {
        font-size: 24px !important;
      }

      h3 {
        font-size: 20px !important;
      }

      h2, h3, h4 {
        font-size: 14px;
        font-weight: normal;
        line-height: 20px;
        margin: 0;
        padding: 5px 0;
      }

      .bold {
        font-weight: bold;
      }

      hr {
        margin: 10px 0;
      }

      .api_test {
        font-size: 12px;
      }

      .api_test button {
        font-size: 14px;
      }

      .api_test pre {
        font-size: 14px;
      }
    </style>
</head>
<body>
<div style="padding-bottom: 20px">location.search=<span class="js_search"></span></div>

<section class="api_test">
    <button id="js_get_500">GET 500</button>
    <button id="js_get_401">GET 401</button>
    <button id="js_post_500">POST 500</button>
    <button id="js_post_401">POST 401</button>
    <br />
    <button id="js_tcg_get_500">TCG GET 500</button>
    <pre id="js_api_result"></pre>
</section>

<h4 style="font-family: Arial, Verdana, sans-serif">0. [大] वर्तमान में कोई प्रमोशन नहीं</h4>
<h3 style="font-family: Arial, Verdana, sans-serif">0. [小] वर्तमान में कोई प्रमोशन नहीं</h3>
<h2 style="font-family: Arial, Verdana, sans-serif">0. [小] वर्तमान में कोई प्रमोशन नहीं</h2>
<hr/>
<h4 style="font-family: Meiryo,Arial, Verdana, sans-serif">1. [小] Test Meiryo: वर्तमान में कोई प्रमोशन नहीं</h4>
<h3 style="font-family: Meiryo,Arial, Verdana, sans-serif">1. [中] Test Meiryo: वर्तमान में कोई प्रमोशन नहीं</h3>
<h2 style="font-family: Meiryo,Arial, Verdana, sans-serif">1. [大] Test Meiryo: वर्तमान में कोई प्रमोशन नहीं</h2>
<h4 style="font-family: 'Noto Sans JP',Arial, Verdana, sans-serif">2. [小] Test Noto Sans JP: वर्तमान में कोई प्रमोशन
    नहीं</h4>
<h3 style="font-family: 'Noto Sans JP',Arial, Verdana, sans-serif">2. [中] Test Noto Sans JP: वर्तमान में कोई प्रमोशन
    नहीं</h3>
<h2 style="font-family: 'Noto Sans JP',Arial, Verdana, sans-serif">2. [大] Test Noto Sans JP: वर्तमान में कोई प्रमोशन
    नहीं</h2>
<h4 style="font-family: Helvetica,Arial, Verdana, sans-serif">3. [小] Test Helvetica: वर्तमान में कोई प्रमोशन नहीं</h4>
<h3 style="font-family: Helvetica,Arial, Verdana, sans-serif">3. [中] Test Helvetica: वर्तमान में कोई प्रमोशन नहीं</h3>
<h2 style="font-family: Helvetica,Arial, Verdana, sans-serif">3. [大] Test Helvetica: वर्तमान में कोई प्रमोशन नहीं</h2>
<hr/>
<h4 class="bold" style="font-family: Meiryo,Arial, Verdana, sans-serif">4. [小] Test Meiryo: वर्तमान में कोई प्रमोशन
    नहीं</h4>
<h3 class="bold" style="font-family: Meiryo,Arial, Verdana, sans-serif">4. [中] Test Meiryo: वर्तमान में कोई प्रमोशन
    नहीं</h3>
<h2 class="bold" style="font-family: Meiryo,Arial, Verdana, sans-serif">4. [大] Test Meiryo: वर्तमान में कोई प्रमोशन
    नहीं</h2>
<h4 class="bold" style="font-family: 'Noto Sans JP',Arial, Verdana, sans-serif">5. [小] Test Noto Sans JP: वर्तमान में
    कोई प्रमोशन नहीं</h4>
<h3 class="bold" style="font-family: 'Noto Sans JP',Arial, Verdana, sans-serif">5. [中] Test Noto Sans JP: वर्तमान में
    कोई प्रमोशन नहीं</h3>
<h2 class="bold" style="font-family: 'Noto Sans JP',Arial, Verdana, sans-serif">5. [大] Test Noto Sans JP: वर्तमान में
    कोई प्रमोशन नहीं</h2>
<h4 class="bold" style="font-family: Helvetica,Arial, Verdana, sans-serif">6. [小] Test Helvetica: वर्तमान में कोई
    प्रमोशन नहीं</h4>
<h3 class="bold" style="font-family: Helvetica,Arial, Verdana, sans-serif">6. [中] Test Helvetica: वर्तमान में कोई
    प्रमोशन नहीं</h3>
<h2 class="bold" style="font-family: Helvetica,Arial, Verdana, sans-serif">6. [大] Test Helvetica: वर्तमान में कोई
    प्रमोशन नहीं</h2>
<hr/>
<button id="btn">open https</button>
<button id="btn2">open http</button>

<a aria-disabled="false" rel="nofollow me noopener noreferrer" id="a1"
   href="http://launch2.yoopayment.com/yxfwl/120606/sender.do?senderKey=c2e83157-c7c8-4fbb-8e3d-bb5114f08fa5">
    a open http
</a>
<a aria-disabled="false" rel="nofollow me noopener noreferrer" id="a2" href="https://www.google.com">
    a open https
</a>
<br/><br/>
<button aria-disabled="false" rel="nofollow me noopener noreferrer" id="a3">
    LINE專用 外跳用chrome
</button>
<button aria-disabled="false" rel="nofollow me noopener noreferrer" id="a4">
    LINE專用 外跳預設瀏覽器
</button>
<script src="./js/vconsole.min.js"></script>
<script>
  var vConsole = new VConsole();
</script>
<script>
  function outputAPI(title, text) {
    try {
      $("#js_api_result").text(title + "\n"+ JSON.stringify(JSON.parse(text), undefined, 2));
    } catch (e) {
      $("#js_api_result").text(title + "\n"+ text);
    }
  }
  $(function () {
    $(".js_search").html(location.search);

    $("#js_get_500").click(function (e) {
      fetch("https://tcgtest.free.beeceptor.com/echo/get500",
        {
          headers: {
            'cache-control': 'no-cache'
          },
        })
        .then(function (e) {
          return e.text();
        })
        .then(function (e) {
          outputAPI('js_get_500', e);
        });
    });

    $("#js_get_401").click(function (e) {
      fetch("https://tcgtest.free.beeceptor.com/echo/get401",
        {
          headers: {
            'cache-control': 'no-cache'
          },
        })
        .then(function (e) {
          return e.text();
        })
        .then(function (e) {
          outputAPI('js_get_401', e);
        });
    });

    $("#js_post_500").click(function (e) {
      fetch("https://tcgtest.free.beeceptor.com/echo/post500",
        {
          body: JSON.stringify({ username: "test" }), // must match 'Content-Type' header
          headers: {
            'content-type': 'application/json',
            'cache-control': 'no-cache'
          },
          method: 'POST', // *GET, POST, PUT, DELETE, etc.
        })
        .then(function (e) {
          return e.text();
        })
        .then(function (e) {
          outputAPI('js_post_500', e);
        });
    });

    $("#js_post_401").click(function (e) {
      fetch("https://tcgtest.free.beeceptor.com/echo/post401",
        {
          body: JSON.stringify({ username: "test" }), // must match 'Content-Type' header
          headers: {
            'content-type': 'application/json',
            'cache-control': 'no-cache'
          },
          method: 'POST', // *GET, POST, PUT, DELETE, etc.
        })
        .then(function (e) {
          return e.text();
        })
        .then(function (e) {
          outputAPI('js_post_401', e);
        });
    });

    $('#js_tcg_get_500').click(function (e) {
      fetch("/wps/system/status",
        {
          headers: {
            'Merchant': 'test',
            'cache-control': 'no-cache',
          },
          method: 'GET', // *GET, POST, PUT, DELETE, etc.
        })
        .then(function (e) {
          return e.text();
        })
        .then(function (e) {
          outputAPI('js_tcg_get_500', e);
        });
    });

  });
  document.querySelector("#btn").addEventListener("click", () => {
    const p = "https://www.google.com";
    const win = window.open(p, "_blank");
    if (!win) {
      return;
    }
    win.opener = null; // security problem
    if (win.location.href && !win.location.href.startsWith("http")) {
      win.location.href = p;
    }
    win.focus();
  });

  document.querySelector("#btn2").addEventListener("click", () => {
    const p = "http://launch2.yoopayment.com/yxfwl/120606/sender.do?senderKey=c2e83157-c7c8-4fbb-8e3d-bb5114f08fa5";
    const win = window.open(p, "_blank");
    if (!win) {
      return;
    }
    win.opener = null; // security problem
    if (win.location.href && !win.location.href.startsWith("http")) {
      win.location.href = p;
    }
    win.focus();
  });

  var handleWindowPage = (p) => {
    const win = window.open(p, "_blank");
    if (!win) {
      return;
    }
    win.opener = null; // security problem
    if (win.location.href && !win.location.href.startsWith("http")) {
      win.location.href = p;
    }
    win.focus();
  };


  const isLine = /LINE/i.test(window.navigator.userAgent);
  const isIos = /iP(hone|od|ad)/.test(window.navigator.platform);
  const popup = (p, defaultBrowser = false) => {
    if (isLine) {
      try {
        const url = new URL(p.startsWith("http") ? p : `https://${p}`);
        if (isIos || !defaultBrowser) {
          const params = Qs.parse(url.search, { ignoreQueryPrefix: true });
          params.openExternalBrowser = 1;
          alert("準備打開預設瀏覽器=" + `${url.origin}${url.pathname}?${Qs.stringify(params)}`);
          location.href = `${url.origin}${url.pathname}?${Qs.stringify(params)}`;
        } else {
          let convert;
          if (p.startsWith("http")) {
            convert = p.replace(/http/, "googlechrome");
          } else {
            convert = `googlechromes://${p}`;
          }
          location.href = convert;
        }
        return;
      } catch (e) {
      }
    } else {
      alert("不是line");
    }
  };

  var onClose;
  document.querySelector("#a1").addEventListener("click", (e) => {
    e.preventDefault();
    handleWindowPage("http://launch2.yoopayment.com/yxfwl/120606/sender.do?senderKey=c2e83157-c7c8-4fbb-8e3d-bb5114f08fa5");
    setTimeout(() => {
      typeof onClose === "function" && onClose();
    }, 1000);
    return false;
  });

  document.querySelector("#a2").addEventListener("click", (e) => {
    e.preventDefault();
    handleWindowPage("https://www.google.com");
    setTimeout(() => {
      typeof onClose === "function" && onClose();
    }, 1000);
    return false;
  });

  document.querySelector("#a3").addEventListener("click", (e) => {
    e.preventDefault();
    popup("https://dwpub.ftpidc.cn/WIQl");
    return false;
  });

  document.querySelector("#a4").addEventListener("click", (e) => {
    e.preventDefault();
    popup("https://dwpub.ftpidc.cn/WIQl", true);
    return false;
  });

  fetch("https://abc123.huamei2.com/wps/system/test/ping?_=" + new Date().getTime());
</script>
</body>
</html>
