<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>你好，GitHub</title>
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.9.3/qs.min.js"></script>-->
    <link href="./stylesheets/jp-font.css" rel="stylesheet" media="print" onload="this.media='all'">
    <!-- Fallback that only gets inserted when JavaScript is disabled, in which case we can't load CSS asynchronously. -->
    <noscript><link rel="stylesheet" href="./stylesheets/jp-font.css"></noscript>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
    <style>
      /*@font-face {*/
      /*  font-family: "Noto Sans JP";*/
      /*  src: url("./stylesheets/fonts/NotoSansJP-Regular.otf");*/
      /*  font-display: swap;*/
      /*}*/
      /*@font-face {*/
      /*  font-family: "Noto Sans JP";*/
      /*  src: url("./stylesheets/fonts/NotoSansJP-Bold.otf");*/
      /*  font-weight: bold;*/
      /*  font-display: swap;*/
      /*}*/

      h2 {
        font-size: 24px !important;
      }

      h3 {
        font-size: 20px !important;
      }

      h2, h3, h4 {
        font-size: 14px;
        font-weight: normal;
        line-height: 20px;
        margin: 0;
        padding: 5px 0;
      }

      .bold {
        font-weight: bold;
      }

      hr {
        margin: 10px 0;
      }
    </style>
</head>
<body>
<div style="padding-bottom: 20px">location.search=<span class="js_search"></span></div>
<button id="btn">open https</button>
<button id="btn2">open http</button>

<a aria-disabled="false" rel="nofollow me noopener noreferrer" id="a1"
   href="http://launch2.yoopayment.com/yxfwl/120606/sender.do?senderKey=c2e83157-c7c8-4fbb-8e3d-bb5114f08fa5">
    a open http
</a>
<a aria-disabled="false" rel="nofollow me noopener noreferrer" id="a2" href="https://www.google.com">
    a open https
</a>
<br/><br/>
<button aria-disabled="false" rel="nofollow me noopener noreferrer" id="a3">
    LINE專用 外跳用chrome
</button>
<button aria-disabled="false" rel="nofollow me noopener noreferrer" id="a4">
    LINE專用 外跳預設瀏覽器
</button>
<script>
  $(function() {
    $(".js_search").html(location.search);
  });
  document.querySelector("#btn").addEventListener("click", () => {
    const p = "https://www.google.com";
    const win = window.open(p, "_blank");
    if (!win) {
      return;
    }
    win.opener = null; // security problem
    if (win.location.href && !win.location.href.startsWith("http")) {
      win.location.href = p;
    }
    win.focus();
  });

  document.querySelector("#btn2").addEventListener("click", () => {
    const p = "http://launch2.yoopayment.com/yxfwl/120606/sender.do?senderKey=c2e83157-c7c8-4fbb-8e3d-bb5114f08fa5";
    const win = window.open(p, "_blank");
    if (!win) {
      return;
    }
    win.opener = null; // security problem
    if (win.location.href && !win.location.href.startsWith("http")) {
      win.location.href = p;
    }
    win.focus();
  });

  var handleWindowPage = (p) => {
    const win = window.open(p, "_blank");
    if (!win) {
      return;
    }
    win.opener = null; // security problem
    if (win.location.href && !win.location.href.startsWith("http")) {
      win.location.href = p;
    }
    win.focus();
  };


  const isLine = /LINE/i.test(window.navigator.userAgent);
  const isIos = /iP(hone|od|ad)/.test(window.navigator.platform);
  const popup = (p, defaultBrowser = false) => {
    if (isLine) {
      try {
        const url = new URL(p.startsWith("http") ? p : `https://${p}`);
        if (isIos || !defaultBrowser) {
          const params = Qs.parse(url.search, { ignoreQueryPrefix: true });
          params.openExternalBrowser = 1;
          alert("準備打開預設瀏覽器=" + `${url.origin}${url.pathname}?${Qs.stringify(params)}`);
          location.href = `${url.origin}${url.pathname}?${Qs.stringify(params)}`;
        } else {
          let convert;
          if (p.startsWith("http")) {
            convert = p.replace(/http/, "googlechrome");
          } else {
            convert = `googlechromes://${p}`;
          }
          location.href = convert;
        }
        return;
      } catch (e) {
      }
    } else {
      alert("不是line");
    }
  };

  var onClose;
  document.querySelector("#a1").addEventListener("click", (e) => {
    e.preventDefault();
    handleWindowPage("http://launch2.yoopayment.com/yxfwl/120606/sender.do?senderKey=c2e83157-c7c8-4fbb-8e3d-bb5114f08fa5");
    setTimeout(() => {
      typeof onClose === "function" && onClose();
    }, 1000);
    return false;
  });

  document.querySelector("#a2").addEventListener("click", (e) => {
    e.preventDefault();
    handleWindowPage("https://www.google.com");
    setTimeout(() => {
      typeof onClose === "function" && onClose();
    }, 1000);
    return false;
  });

  document.querySelector("#a3").addEventListener("click", (e) => {
    e.preventDefault();
    popup("https://dwpub.ftpidc.cn/WIQl");
    return false;
  });

  document.querySelector("#a4").addEventListener("click", (e) => {
    e.preventDefault();
    popup("https://dwpub.ftpidc.cn/WIQl", true);
    return false;
  });

</script>
</body>
</html>
